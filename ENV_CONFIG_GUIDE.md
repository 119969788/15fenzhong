# 环境变量配置指南

## 配置文件说明

项目使用 `.env` 文件存储配置信息。请参考 `.env.example` 文件创建你的 `.env` 文件。

## 快速开始

```bash
# 复制示例文件
cp .env.example .env

# 编辑配置文件
nano .env
# 或使用 vim
# vim .env
```

## 配置项详细说明

### 🔑 必需配置

#### `POLYMARKET_PRIVATE_KEY`
- **类型**: 字符串
- **格式**: `0x` 开头的 64 位十六进制字符串
- **说明**: 你的 Polygon 钱包私钥，用于签名交易
- **示例**: `0xd4ae880287b31d8316f31e938a4bb50d6260d765229076be83d8fa7962f2531b`
- **⚠️ 安全警告**: 
  - 此私钥控制你的钱包，请妥善保管
  - 不要将 `.env` 文件提交到 Git
  - 不要分享给任何人
  - 建议使用专门的交易钱包，不要使用主钱包

### 🌐 网络配置

#### `POLYGON_RPC_URL`
- **类型**: 字符串（URL）
- **默认**: `https://polygon-rpc.com`
- **说明**: Polygon 网络的 RPC 节点 URL
- **推荐**: 使用自己的 RPC 节点以获得更好的性能和稳定性
- **免费 RPC 提供商**:
  - Ankr: `https://rpc.ankr.com/polygon/...`
  - Alchemy: `https://polygon-mainnet.g.alchemy.com/v2/...`
  - Infura: `https://polygon-mainnet.infura.io/v3/...`
- **示例**: `https://rpc.ankr.com/polygon/e3c8be4db7f6c83c2600000a4b91778ebe2ac1a256c19de7b460fc4753dc2447`

### 📊 市场配置

#### `SLUG_PREFIX`
- **类型**: 字符串
- **默认**: `eth-updown-15m-`
- **说明**: 市场 slug 前缀，用于匹配要交易的市场
- **示例**: 
  - `eth-updown-15m-` - ETH 15 分钟 Up/Down 市场
  - `btc-updown-15m-` - BTC 15 分钟 Up/Down 市场

### 💰 交易价格阈值

#### `BUY_PRICE`
- **类型**: 数字（0.00 - 1.00）
- **默认**: `0.80`
- **说明**: 买入价格阈值。当订单簿中的最佳卖价（bestAsk）<= 此价格时，触发买入
- **策略建议**: 
  - 较低的值（如 0.70-0.80）：更激进，买入机会更多
  - 较高的值（如 0.85-0.95）：更保守，买入机会较少

#### `SELL_PRICE`
- **类型**: 数字（0.00 - 1.00）
- **默认**: `0.90`
- **说明**: 卖出价格阈值。当订单簿中的最佳买价（bestBid）>= 此价格时，触发卖出
- **策略建议**: 
  - 较低的值（如 0.80-0.85）：更早卖出，利润较小但风险低
  - 较高的值（如 0.90-0.95）：更晚卖出，利润较大但可能错过机会

### 📦 交易数量配置

#### `BUY_USDC`
- **类型**: 数字
- **默认**: `20`
- **单位**: USDC
- **说明**: 每次买入花费的 USDC 数量
- **建议**: 根据你的资金量和风险承受能力调整
  - 小额测试：10-20 USDC
  - 正常交易：20-50 USDC
  - 大额交易：50-100+ USDC

#### `SELL_SHARES`
- **类型**: 数字
- **默认**: `20`
- **单位**: 份额（shares）
- **说明**: 每次卖出的份额数量
- **注意**: 实际卖出数量 = min(持仓数量, SELL_SHARES)

#### `MAX_POS_EACH`
- **类型**: 数字
- **默认**: `200`
- **单位**: 份额（shares）
- **说明**: 每个方向（Up/Down）的最大持仓限制
- **作用**: 当持仓达到此数量时，将不再买入，用于控制风险

### 📋 订单类型配置

#### `ORDER_TYPE`
- **类型**: 字符串
- **可选值**: `FOK` 或 `FAK`
- **默认**: `FOK`
- **说明**: 订单执行类型
- **FOK (Fill-or-Kill)**:
  - 全部成交或全部取消
  - **推荐使用**：避免部分成交导致的价格滑点
  - 如果订单无法全部成交，将自动取消
- **FAK (Fill-and-Kill)**:
  - 能成交多少就成交多少，剩余部分自动取消
  - 可能导致部分成交，价格可能不如预期

### ⏱️ 轮询配置

#### `POLL_MS`
- **类型**: 数字（毫秒）
- **默认**: `500`
- **说明**: 订单簿轮询间隔，即检查价格和执行交易的频率
- **建议值**: 
  - 300-500ms：快速响应，但可能触发 API 限流
  - 500-1000ms：平衡性能和响应速度（推荐）
  - 1000ms+：较慢，但更稳定
- **注意**: 设置过小可能导致 API 限流，建议不要低于 300ms

#### `REFRESH_SLUG_MS`
- **类型**: 数字（毫秒）
- **默认**: `2000`
- **说明**: 市场 slug 刷新间隔，即检查是否有新市场的频率
- **建议值**: 
  - 1000-2000ms：快速检测新市场（推荐）
  - 2000-5000ms：平衡性能和检测速度
  - 5000ms+：较慢，但减少 API 调用

## 配置示例

### 保守策略（低风险）
```env
BUY_PRICE=0.75
SELL_PRICE=0.85
BUY_USDC=10
SELL_SHARES=10
MAX_POS_EACH=100
ORDER_TYPE=FOK
POLL_MS=1000
```

### 激进策略（高风险高收益）
```env
BUY_PRICE=0.85
SELL_PRICE=0.95
BUY_USDC=50
SELL_SHARES=50
MAX_POS_EACH=500
ORDER_TYPE=FOK
POLL_MS=300
```

### 平衡策略（推荐）
```env
BUY_PRICE=0.80
SELL_PRICE=0.90
BUY_USDC=20
SELL_SHARES=20
MAX_POS_EACH=200
ORDER_TYPE=FOK
POLL_MS=500
REFRESH_SLUG_MS=2000
```

## 安全建议

1. ⚠️ **私钥安全**
   - 永远不要将 `.env` 文件提交到 Git
   - 不要分享给任何人
   - 使用专门的交易钱包，不要使用主钱包
   - 定期检查钱包余额和交易记录

2. ⚠️ **资金管理**
   - 确保钱包有足够的 USDC 用于交易
   - 确保钱包有足够的 MATIC 用于 Gas 费（建议至少 1-2 MATIC）
   - 设置合理的 `MAX_POS_EACH` 限制，避免过度持仓

3. ⚠️ **风险控制**
   - 从小额开始测试（如 10-20 USDC）
   - 根据市场情况调整价格阈值
   - 定期检查日志，监控异常活动
   - 设置止损策略

## 常见问题

### Q: 如何获取私钥？
A: 从 MetaMask 或其他钱包导出私钥。**注意安全，不要泄露！**

### Q: 如何选择 RPC 节点？
A: 推荐使用 Ankr、Alchemy 或 Infura 的免费 RPC。注册账号后获取 API Key。

### Q: BUY_PRICE 和 SELL_PRICE 如何设置？
A: 
- `BUY_PRICE` 应该低于市场当前价格，才能买入
- `SELL_PRICE` 应该高于买入价格，才能盈利
- 建议差价至少 0.05-0.10 以覆盖 Gas 费和滑点

### Q: 为什么订单没有执行？
A: 检查：
1. 价格是否达到阈值
2. 是否有足够的 USDC/MATIC
3. 持仓是否达到上限
4. 查看日志：`pm2 logs 15fenzhong`

### Q: 如何测试配置？
A: 
1. 先使用小额资金测试（如 10 USDC）
2. 设置较宽松的价格阈值
3. 观察日志输出
4. 确认交易正常后再调整参数

## 更新配置

修改 `.env` 文件后，需要重启服务：

```bash
# 重启 PM2 服务
pm2 restart 15fenzhong

# 查看日志确认配置生效
pm2 logs 15fenzhong
```
